name: Shorebird Release

on:
  push:
    branches: [feature/handle-to-use-shorebird]
  pull_request:
    branches: [feature/handle-to-use-shorebird]

env:
  SHOREBIRD_TOKEN: ${{ secrets.SHOREBIRD_TOKEN }}

jobs:
  release:
    defaults:
      run:
        shell: bash

    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“š Git Checkout
        uses: actions/checkout@v3

      - name: ğŸ¦ Setup Shorebird
        uses: shorebirdtech/setup-shorebird@v1
        with:
          cache: true

      - name: ğŸ§© Setup Flutter
        uses: subosito/flutter-action@v2
        with:
          flutter-version: "3.24.0"

      - name: ğŸ”ƒ Install dependencies
        run: flutter pub get

      - name: ğŸ› ï¸ Generate code
        run: flutter pub run build_runner build --delete-conflicting-outputs

      - name: Setup .env
        run: cp .env.example .env

      - name: ğŸš€ Shorebird Release
        uses: shorebirdtech/shorebird-release@v0
        with:
          platform: android # or 'ios'
