image: ghcr.io/cirruslabs/flutter:stable

stages:
  - patch

workflow:
  rules:
    - if: '$CI_COMMIT_BRANCH == "feature/handle-to-use-shorebird"'

variables:
  SHOREBIRD_TOKEN: $SHOREBIRD_TOKEN
  SHOREBIRD_VERSION: stable

patch_android:
  stage: patch
  before_script:
    - apt-get update && apt-get install -y curl unzip git
    - echo "ðŸ“¦ Installing Shorebird CLI..."
    - curl --proto '=https' --tlsv1.2 https://raw.githubusercontent.com/shorebirdtech/install/main/install.sh -sSf | bash
    - export PATH="$HOME/.shorebird/bin:$PATH"
    - shorebird --version
    - echo "ðŸ”‘ Authenticating Shorebird..."
    - echo "$SHOREBIRD_TOKEN" | shorebird login
  script:
    - echo "ðŸš€ Creating patch for Android..."
    - shorebird release android
    - shorebird patch android
